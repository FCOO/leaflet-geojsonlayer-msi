!function(a,b,c,d,e){"use strict";var f=b.divIcon({className:"msi-marker",iconSize:[20,20],iconAnchor:[11,11]}),g=new c.LatLngFormat(1),h=function(a,b,c){var d,e="DD-MMM-YY HH:mm",f=moment.utc(a),g="da"==b?"lokal":"local";return d="local"==c?f.local().format(e)+"&nbsp;("+g+")":f.utc().format(e)+"&nbsp;(UTC)"};return b.GeoJSON.MSI=b.GeoJSON.extend({options:{language:"en",timezone:"local",protocol:c.location.protocol,baseurl:"//app.fcoo.dk/warnings/msi/msi_{language}.json",pointToLayer:function(a,c){var d=b.marker(c,{icon:f});return d.on("add",function(){this._icon.title="MSI: "+a.properties.encText+"\n"+a.properties.mainarea+" - "+a.properties.subarea},d),d},style:function(){return{weight:2,color:"#e2007a",opacity:1,fillColor:"#e2007a",fillOpacity:.2}}},initialize:function(c){var d=this;b.setOptions(this,c),this._layers={},this.options.url=this.options.protocol+this.options.baseurl.replace("{language}",this.options.language),this.jqxhr=a.getJSON(this.options.url),this.jqxhr.done(function(a){d.addData(a)}),this.options.onEachFeature=function(a,b){var c,e;b.on({click:function(f){c="<p>Position: {latitude}&nbsp;&nbsp;{longitude}</p>",e="da"==a.properties.language?'<div class="msi"><h4>Aktuelle advarsler</h4><p>{body}</p><hr/><p>Tid: {updated}</p><hr/><p>Hovedområde: {mainarea}</p><p>Underområde: {subarea}</p><hr/>{points}<hr/><p>Kilde: <a target="_new" href="http://www.soefartsstyrelsen.dk">Søfartsstyrelsen</a></p></div>':'<div class="msi"><h4>Maritime Safety Information</h4><p>{body}</p><hr/><p>Time: {updated}</p><hr/><p>Main area: {mainarea}</p><p>Subarea: {subarea}</p><hr/>{points}<hr/><p>Source: <a target="_new" href="http://dma.dk">Danish Maritime Authority</a></p></div>';var i=e.replace("{title}",a.properties.encText);i=i.replace("{body}",a.properties.navWarning),i=i.replace("{updated}",h(a.properties.updated,a.properties.language,d.options.timezone)),i=i.replace("{mainarea}",a.properties.mainarea),i=i.replace("{subarea}",a.properties.subarea);var j="";if("Point"!==a.geometry.type)for(var k in a.geometry.geometries[0].coordinates){var l=a.geometry.geometries[0].coordinates[k];j+=c,j=j.replace("{longitude}",g.asTextLng(l[0])),j=j.replace("{latitude}",g.asTextLat(l[1]))}else j=c.replace("{longitude}",g.asTextLng(a.geometry.coordinates[0])),j=j.replace("{latitude}",g.asTextLat(a.geometry.coordinates[1]));i=i.replace("{points}",j),b._map.openPopup(i,f.latlng,{maxWidth:300,maxHeight:400})}})}},onAdd:function(a){var c=this;this.jqxhr.done(function(){b.GeoJSON.prototype.onAdd.call(c,a)}),a.on("timezonechange",function(a){c.options.timezone=a.timezone})}}),b.GeoJSON.MSI}(jQuery,L,this,document);