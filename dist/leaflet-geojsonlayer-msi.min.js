!function(a,b,c,d,e){"use strict";var f=b.divIcon({className:"msi-marker",iconSize:[20,20],iconAnchor:[11,11]}),g=function(a,b,c){var d,e="DD-MMM-YY HH:mm",f=moment.utc(a),g="da"==b?"lokal":"local";return d="local"==c?f.local().format(e)+"&nbsp;("+g+")":f.utc().format(e)+"&nbsp;(UTC)"},h=b.Class.extend({initialize:function(a,b){this.feature=a,this.geoJSON_MSI=b},updatePopup:function(){function a(a){for(var b in a)f=f.replace("{"+b+"}",a[b])}var c,d,e=this.geoJSON_MSI.options,f=e.popup_template,h=e.text[e.language]||e.text.da,i=[],j="";if("Point"!==this.feature.geometry.type)for(d in this.feature.geometry.geometries[0].coordinates)i.push(b.latLng(this.feature.geometry.geometries[0].coordinates[d]));else i.push(b.latLng(this.feature.geometry.coordinates));for(h.header_position=1==i.length?h.header_position:h.header_positions,a(h),a({title:this.feature.properties.encText,body:this.feature.properties.navWarning,updated:g(this.feature.properties.updated,e.language,e.timezone),mainarea:this.feature.properties.mainarea,subarea:this.feature.properties.subarea}),c=0;c<i.length;c++)j+=(c?"<br>":"")+i[c].asFormat().join("&nbsp;&nbsp;&nbsp;");return a({points:j}),f}});return b.GeoJSON.MSI=b.GeoJSON.extend({options:{language:"en",timezone:"local",protocol:c.location.protocol,baseurl:"//app.fcoo.dk/warnings/msi/msi_{language}.json",pointToLayer:function(a,c){var d=b.marker(c,{icon:f});return d.on("add",function(){this._icon.title="MSI: "+a.properties.encText+"\n"+a.properties.mainarea+" - "+a.properties.subarea},d),d},style:function(){return{weight:2,color:"#e2007a",opacity:1,fillColor:"#e2007a",fillOpacity:.2}},popup_template:'<div class="msi"><h3>{header}</h3><p>{body}</p><hr/><h4>{header_time}</h4><p>{updated}</p><hr/><h4>{header_area}</h4><p>{mainarea}&nbsp;-&nbsp;{subarea}</p><hr/><h4>{header_position}</h4>{points}<hr/><h4>{header_source}</h4><p>{source_link}</p></div>',text:{da:{header:"Aktuelle advarsler",header_time:"Tid",header_area:"Område",header_main_area:"Hovedområde",header_subarea:"Underområde",header_position:"Position",header_positions:"Positioner",header_source:"Kilde",source_link:'<a target="_new" href="http://www.soefartsstyrelsen.dk">Søfartsstyrelsen</a>'},en:{header:"Maritime Safety Information",header_time:"Time",header_area:"Area",header_main_area:"Main area",header_subarea:"Subarea",header_position:"Position",header_positions:"Positions",header_source:"Source",source_link:'<a target="_new" href="http://dma.dk">Danish Maritime Authority</a>'}}},initialize:function(c){var d=this;b.setOptions(this,c),this._layers={},this.options.url=this.options.protocol+this.options.baseurl.replace("{language}",this.options.language),this.jqxhr=a.getJSON(this.options.url),this.jqxhr.done(function(a){d.addData(a)}),this.options.onEachFeature=function(a,b){var c=new h(a,d);b.bindPopup("",{maxWidth:300,maxHeight:400,getContent:c.updatePopup,context:c,updateOnMapEvents:"latlngformatchange"})}},onAdd:function(a){var c=this;this.jqxhr.done(function(){b.GeoJSON.prototype.onAdd.call(c,a)}),a.on("timezonechange",function(a){c.options.timezone=a.timezone})}}),b.GeoJSON.MSI}(jQuery,L,this,document);