!function(a,b,c,d,e){"use strict";var f=b.divIcon({className:"msi-marker",iconSize:[20,20],iconAnchor:[11,11]}),g=function(a,b,c){var d,e="DD-MMM-YY HH:mm",f=moment.utc(a),g="da"==b?"lokal":"local";return d="local"==c?f.local().format(e)+"&nbsp;("+g+")":f.utc().format(e)+"&nbsp;(UTC)"},h=b.Class.extend({initialize:function(a,b){this.feature=a,this.geoJSON_MSI=b},updatePopup:function(){function a(a){var b={};for(var c in a)b[c]=a[c][j];return b}function c(a){for(var b in a)h=h.replace(new RegExp("{"+b+"}","g"),a[b])}var d,e,f=this.geoJSON_MSI.options,h=f.template.popup,i=f.text,j=f.language||"da",k=[],l="";if("Point"!==this.feature.geometry.type)for(e in this.feature.geometry.geometries[0].coordinates)k.push(b.latLng(this.feature.geometry.geometries[0].coordinates[e]));else k.push(b.latLng(this.feature.geometry.coordinates));for(i.header_position=1==k.length?i.header_position:i.header_positions,c(a(i)),c({title:this.feature.properties.encText,body:this.feature.properties.navWarning,updated:g(this.feature.properties.updated,f.language,f.timezone),mainarea:this.feature.properties.mainarea,subarea:this.feature.properties.subarea}),d=0;d<k.length;d++)l+=(d?"<br>":"")+k[d].asFormat().join("&nbsp;&nbsp;&nbsp;");return c({points:l}),h}});return b.GeoJSON.MSI=b.GeoJSON.extend({options:{language:"en",timezone:"local",protocol:c.location.protocol,baseurl:"//app.fcoo.dk/warnings/msi/msi_{language}.json",pointToLayer:function(a,c){var d=b.marker(c,{icon:f});return d.on("add",function(){this._icon.title="MSI: "+a.properties.encText+"\n"+a.properties.mainarea+" - "+a.properties.subarea},d),d},style:function(){return{weight:2,color:"#e2007a",opacity:1,fillColor:"#e2007a",fillOpacity:.2}},template:{popup:'<div class="msi"><h3>{header}</h3><p>{body}</p><hr/><h4>{header_time}</h4><p>{updated}</p><hr/><h4>{header_area}</h4><p>{mainarea}&nbsp;-&nbsp;{subarea}</p><hr/><h4>{header_position}</h4>{points}<hr/><h4>{header_source}</h4><p>{source_link}</p></div>'},text:{header:{da:"Aktuelle advarsler",en:"Maritime Safety Information"},header_time:{da:"Tid",en:"Time"},header_area:{da:"Område",en:"Area"},header_main_area:{da:"Hovedområde",en:"Main area"},header_subarea:{da:"Underområde",en:"Subarea"},header_position:{da:"Position",en:"Position"},header_positions:{da:"Positioner",en:"Positions"},header_source:{da:"Kilde",en:"Source"},source_link:{da:'<a target="_new" href="http://www.soefartsstyrelsen.dk">Søfartsstyrelsen</a>',en:'<a target="_new" href="http://dma.dk">Danish Maritime Authority</a>'}}},initialize:function(c){var d=this;b.setOptions(this,c),this._layers={},this.options.url=this.options.protocol+this.options.baseurl.replace("{language}",this.options.language),this.jqxhr=a.getJSON(this.options.url),this.jqxhr.done(function(a){d.addData(a)}),this.options.onEachFeature=function(a,b){var c=new h(a,d);b.bindPopup("",{maxWidth:300,maxHeight:400,getContent:c.updatePopup,context:c,updateOnMapEvents:"latlngformatchange"})}},onAdd:function(a){var c=this;this.jqxhr.done(function(){b.GeoJSON.prototype.onAdd.call(c,a)}),a.on("timezonechange",function(a){c.options.timezone=a.timezone})}}),b.GeoJSON.MSI}(jQuery,L,this,document);